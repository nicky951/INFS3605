{% load static %}
<script>
  function checkFunction() {
    var email = document.getElementById('i25v').value;
    //get response via CORS proxy
    var jsonRequest = "https://cors-anywhere.herokuapp.com/https://haveibeenpwned.com/api/v3/breachedaccount/" + email + "?truncateResponse=false";

    var request = new XMLHttpRequest();

    request.open('GET', jsonRequest, false);
    request.setRequestHeader("hibp-api-key", "38eb580ec92d4403becca47370ac9d1f");
    request.setRequestHeader("Access-Control-Allow-Origin", "*");
    request.send();
    
    var result = JSON.parse(request.response);
    var breachTable = document.getElementById('breachtable');

    for(var i = 0; i < result.length; i++) {
      var row = breachTable.insertRow(i + 1);
      var newC1 = row.insertCell(0);
      newC1.innerHTML = result[i]['Name'];
      var newC2 = row.insertCell(1);
      newC2.innerHTML = "<img src=\"" + result[i]['LogoPath'] + "\" style = \"width: 100px; height: auto;\">";
      var newC3 = row.insertCell(2);
      newC3.innerHTML = result[i]['BreachDate'];
      var newC4 = row.insertCell(3);
      newC4.innerHTML = result[i]['Description'];
    }
    
    document.getElementById('breachtable').style.visibility = 'visible';
  }
</script>
<link rel="stylesheet" type="text/css" href= "{% static 'css/styles.css' %}">
<header class="header-banner" id="iin1" style="background-color: #222222;">
  <div class="container-width" id="ifju">
    <div class="logo-container" id="io2t">
      <div class="logo"> Anova Consulting
      </div>
    </div>
    <nav class="menu">
      <div class="menu-item">AWARENESS GAME
      </div>
      <div class="menu-item" onclick="location.href='/emailchecker'"> BREACH CHECKER
      </div>
      <div class="menu-item">SEC-INFO
      </div>
    </nav>
    <div class="clearfix">
    </div>
    <div class="lead-title" style="width: 500px;">CyberShield Email Checker
    </div>
    </div>
  </div>
</header>
<br></br>
<br></br>
<form class="pwned-form" style="margin-left: 200px; margin-right: 200px; border-radius: 20px;">
  <div class="form-group">
  </div>
  <div class="form-group">
    <label class="pwned-label" id="pwned-ipcx">Email</label>
    <input type="email" placeholder="Type here your email" class="pwned-input" id="i25v"/>
  </div>
  <div class="form-group">
  </div>
  <div class="form-group">
    <button type="button" class="pwned-button" id="check" onclick="checkFunction()">Check</button>
  </div>
</form>
<br></br>
<br></br>
<table class="pwned-table" id="breachtable" style="visibility: hidden; font-family: Helvetica, sans-serif;">
  <thead>
      <tr>
          <th>Breach</th>
          <th>Logo</th>
          <th style="width: 200px;">Date</th>
          <th>Details</th>
      </tr>
  </thead>
  <tbody>
  </tbody>
</table>